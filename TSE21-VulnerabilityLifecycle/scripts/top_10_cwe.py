import json
import pandas as pd

in_file_path = "../data/repos_enriched.json"
out_file_path = "../data/top10cwe.csv"

repos = []
with open(in_file_path, "r") as in_file:
    repos = json.load(in_file)

data = []
for repo in repos:
    for cve in repo["cves"]:
        row = [
            cve["cwe"],
            cve["cve"],
        ]
        data.append(row)
cols = ["cwe", "cve"]
df = pd.DataFrame(data, columns=cols)

cwe_counts = df.groupby("cwe").count().sort_values(by="cve", ascending=False)

with pd.option_context('display.max_rows', None, 'display.max_columns', None):  # more options can be specified also
    print(cwe_counts)
    print(cwe_counts.sum())

cwe_counts[:10].to_csv(out_file_path)
